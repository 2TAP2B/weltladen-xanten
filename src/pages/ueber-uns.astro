---
import BaseLayout from "../layouts/BaseLayout.astro";
import PageHeader from "../components/Sections/PageHeader.astro";
import StaffList from "../components/Sections/StaffList.astro";
import { getAboutPage, getCoreValues, getHistoryTimeline, getBeliefs, getAssetUrl } from "../utils/directus";

// Fetch data from Directus
const aboutPage = await getAboutPage();
const coreValues = await getCoreValues();
const historyTimeline = await getHistoryTimeline();
const beliefs = await getBeliefs();
---

<BaseLayout
  title="Über uns - Weltladen Xanten"
  description="Erfahren Sie mehr über unsere Geschichte, Mission und Werte der Eine Welt Gruppe Xanten."
>
  <PageHeader 
    title={aboutPage?.header_title || "Über uns"} 
    subtitle={aboutPage?.header_subtitle || "Unsere Geschichte, Mission und Werte"}
    backgroundImage={aboutPage?.header_background_image ? getAssetUrl(aboutPage.header_background_image, { width: 1920, height: 600, fit: 'cover' }) : "https://images.unsplash.com/photo-1438032005730-c779502df39b?w=1920&h=600&fit=crop&crop=center"}
  />
  
  <!-- Mission & Vision -->
  <section class="py-16 bg-white dark:bg-gray-900">
    <div class="container">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
        <div>
          <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-900 dark:text-gray-100">
            {aboutPage?.mission_title || "Our Mission"}
          </h2>
          <div 
            class="text-xl text-gray-700 dark:text-gray-300 mb-8 prose dark:prose-invert"
            set:html={aboutPage?.mission_text || "To know Christ and to make Him known through worship, discipleship, fellowship, and service."}
          />
          
          <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-900 dark:text-gray-100">
            {aboutPage?.vision_title || "Our Vision"}
          </h2>
          <div 
            class="text-xl text-gray-700 dark:text-gray-300 mb-8 prose dark:prose-invert"
            set:html={aboutPage?.vision_text || "To be a vibrant, growing community of believers who are transformed by the Gospel and transforming our community with the love of Christ."}
          />
        </div>
        
        <div>
          <img 
            src={aboutPage?.mission_image ? getAssetUrl(aboutPage.mission_image, { width: 800, height: 600, fit: 'cover' }) : "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800&h=600&fit=crop&crop=center"} 
            alt="Weltladen Xanten" 
            class="rounded-lg shadow-lg object-cover w-full h-full"
          />
        </div>
      </div>
    </div>
  </section>
  
  <!-- Core Values -->
  <section class="py-16 bg-gray-50 dark:bg-gray-800">
    <div class="container">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4 text-gray-900 dark:text-gray-100">Unsere Grundwerte</h2>
        <p class="text-xl text-gray-600 dark:text-gray-400 max-w-3xl mx-auto">
          Diese Prinzipien leiten alles, was wir als Gemeinschaft tun
        </p>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {coreValues && coreValues.length > 0 ? (
          coreValues.map((value) => (
            <div class="bg-white dark:bg-gray-900 p-8 rounded-lg shadow-sm hover:shadow-md transition-shadow">
              <div 
                class="w-16 h-16 rounded-full flex items-center justify-center mb-6"
                style={`background-color: ${value.color || '#f97316'}20;`}
              >
                <span 
                  class="material-icons text-4xl"
                  style={`color: ${value.color || '#f97316'};`}
                >
                  {value.icon || 'check_circle'}
                </span>
              </div>
              <h3 class="text-xl font-bold mb-3 text-gray-900 dark:text-gray-100">{value.title}</h3>
              <p class="text-gray-700 dark:text-gray-300">{value.description}</p>
            </div>
          ))
        ) : (
          <div class="col-span-full text-center py-8 text-gray-600 dark:text-gray-400">
            No core values found. Please add them in Directus.
          </div>
        )}
      </div>
    </div>
  </section>
  
  <!-- Church History -->
  <section class="py-16 bg-white dark:bg-gray-900">
    <div class="container">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4 text-gray-900 dark:text-gray-100">
          {aboutPage?.history_title || "Unsere Geschichte"}
        </h2>
        <p class="text-xl text-gray-600 dark:text-gray-400 max-w-3xl mx-auto">
          {aboutPage?.history_subtitle || "Die Geschichte unserer Entwicklung über die Jahre"}
        </p>
      </div>
      
      <div class="max-w-4xl mx-auto">
        {historyTimeline && historyTimeline.length > 0 ? (
          historyTimeline.map((event, index) => (
            <div class="relative pl-8 sm:pl-16 py-6 group">
              <div class={`flex flex-col sm:flex-row items-start mb-1 ${index < historyTimeline.length - 1 ? 'before:absolute before:left-2 sm:before:left-7 before:h-full before:px-px before:bg-gray-300 dark:before:bg-gray-600 before:self-start before:-translate-x-1/2 before:translate-y-3' : ''} after:absolute after:left-2 sm:after:left-7 after:w-4 after:h-4 after:bg-primary-600 after:border-4 after:border-white dark:after:border-gray-900 after:rounded-full after:-translate-x-1/2 after:translate-y-1.5`}>
                <time class="sm:w-28 text-xs text-gray-500 dark:text-gray-400 uppercase">{event.year}</time>
                <div>
                  <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">{event.title}</h3>
                  <p class="text-gray-700 dark:text-gray-300">{event.description}</p>
                </div>
              </div>
            </div>
          ))
        ) : (
          <div class="text-center py-8 text-gray-600 dark:text-gray-400">
            No history events found. Please add them in Directus.
          </div>
        )}
      </div>
    </div>
  </section>
  
  <!-- Leadership Team Preview -->
  <section class="py-16 bg-gray-50 dark:bg-gray-800">
    <div class="container">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4 text-gray-900 dark:text-gray-100">Unser Team</h2>
        <p class="text-xl text-gray-600 dark:text-gray-400 max-w-3xl mx-auto">
          Unser engagiertes Team dient unserer Gemeinschaft mit Leidenschaft und Hingabe
        </p>
      </div>
      
      <!-- Show limited staff preview -->
      <StaffList showAll={false} limit={3} />
      
      <div class="mt-12 text-center">
        <a 
          href="/staff" 
          class="inline-flex items-center justify-center px-5 py-3 text-base font-medium text-white bg-primary-600 rounded-md shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
        >
          Unser gesamtes Team kennenlernen
        </a>
      </div>
    </div>
  </section>
  
  <!-- Statement of Faith -->
  <section class="py-16 bg-white dark:bg-gray-900">
    <div class="container">
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4 text-gray-900 dark:text-gray-100">Woran wir glauben</h2>
        <p class="text-xl text-gray-600 dark:text-gray-400 max-w-3xl mx-auto">
          Unsere Grundüberzeugungen und Werte
        </p>
      </div>
      
      <div class="max-w-4xl mx-auto prose prose-lg dark:prose-invert">
        {beliefs && beliefs.length > 0 ? (
          beliefs.map((belief) => (
            <>
              <h3 class="text-gray-900 dark:text-gray-100">{belief.title}</h3>
              <div set:html={belief.content} class="text-gray-700 dark:text-gray-300" />
            </>
          ))
        ) : (
          <div class="text-center py-8 text-gray-600 dark:text-gray-400">
            No beliefs found. Please add them in Directus.
          </div>
        )}
      </div>
    </div>
  </section>
</BaseLayout>